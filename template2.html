<html>


<body>
    <head>

		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>

  </head> 


  <script>
    //a change of gui, such as textbox happens at the end of function or at function failure.
    //test, "test.html"
    window.sessionStorage
    </script>

      <style>
      table, th, td {
        border: 1px solid black;
       
      }

      
      
      td {
        height: 80px;
        width: 160px;
        text-align: center;
        vertical-align: middle;
      }

      </style>
 

<br>
<div id = "linksHere"></div>
<br>

<div id = "buttonHere"></div>
<div id = "removeMe">
{{range .}}
{{if(eq .Condition 1)}}


<table style="width:60%; border:1px solid black;margin-left:auto;margin-right:auto;">

<tr>

<th><center>Amount to Buy</center></th>
<th><center>Product ID</center></th>
<th><center>Product Name</center></th>
<th><center>Category</center></th>
<th><center>Available</center></th> 
<th><center>Buying</center></th> 
<th><center>Cost for Each</center></th> 
<th><center>Total Cost Items With Tax</center></th> 

</tr>

{{end}}




 
<tr id = "{{.RemoveRecordDivID}}">

<td  > <center><p > <input  class = "V0"  id = "{{.AmountToBuyID}}"  onclick= "changeColorToBlack('{{.AmountToBuyID}}')"    value ="{{.Bought}}"   type="number" name="" placeholder="" size="8">	</p></center></td>
			
<!-- <td><center>{{.Condition}}  {{.RemoveRecordDivID}}</center> </td>-->

<td> <center><p> <input id = "{{.ProductIDID}}" value ="{{.ProductID}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

<td> <center><p> <input id = "" value ="{{.ProductName}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

<td> <center><p> <input id = "" value ="{{.ProductCatTitle}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>


  <td class = "" > <center><p> <input   id = "{{.DivID}}" value ="{{.ProductQuantity}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  <td> <center><p> <input id = "{{.BoughtID}}" value ="{{.Bought}}"  type="" name="" placeholder="" size="8" readonly >	</p></center></td>

  
  <td> <center><p> <input id = "{{.CostID}}" value ="${{.ProductCost}}"  type="" name="" placeholder="" size="" >	</p></center></td>

  <td> <center><p> <input id = "{{.TotalCostID}}" value = "${{.TotalCost}}"   type="" name="" placeholder="" size=""  >	</p></center></td>


</tr>

<tr id="row2" style="display: none;">
  <td colspan="2">Secret row, spooky</td>
</tr>





{{if(eq .Condition2 -1)}}

<tr>
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td>
<td><center> </center>  </td>  
<td><center> </center>  </td> 
<td> <center><p> <input id = "{{.GrandTotalStringID}}" value = "Grand Total: ${{.GrandTotalString}}"   type="" name="" placeholder="test" size="40" readonly >	</p></center></td>
 </tr>

</table>
<br><br>
<center><button onclick="checkAllAvailableProducts('{{.DivID}}' , '{{.GrandTotalString}}', '{{.GrandTotalStringID}}' )">Checkout</button></center>


    
    
{{end}}
{{end}}

</div><!--removeMe-->


<script >





  
  
function changeColorToBlack(AmountToBuyID)
{
  document.getElementById(AmountToBuyID).style.color = "black";
  document.getElementById(AmountToBuyID).value = "";
 
}

function hideRow(rowId)
{
    document.getElementById(rowId).style.display = "none";
}


///////

function sqrt(value) {
    if (value < 0n) {
        throw 'square root of negative numbers is not supported'
    }

    if (value < 2n) {
        return value;
    }

    function newtonIteration(n, x0) {
        const x1 = ((n / x0) + x0) >> 1n;
        if (x0 === x1 || x0 === (x1 - 1n)) {
            return x0;
        }
        return newtonIteration(n, x1);
    }

    return newtonIteration(value, 1n);
}

//////

//checkout pressed from template2
function checkAllAvailableProducts(quantity, gtotal, grandTotalID){





  var gtotal = parseFloat(gtotal);
  

  var val1 = "";
  
  var var1 = "A";
  
  var var2 = "C";
 
  var var3 = "D"; 

  var var4 = "B";

  var var5 = "V";

  var var6 = "P";

  var counter = -1;
  var string = "";

  var item = 0;
  var AmountToBuyID = 0;
  var AmountOfCostID = 0;
  var AmountOfQuantityID = 0; 
  var bought = 0;
  
    
    var flag = "isNotNegValue";
    let keys = Object.keys(sessionStorage);
    
    var amtOfHiddenProducts = 0;

    //each iteration is one purchase
    for(let key of keys) {
        counter++;
        if(key =="session_userID")
        {
          counter--;
         
          continue;
        }
        
        if(key =="keywords")
        {
          counter--;
          
          continue;
        }
        if(key =="numberOfRecords")
        {
          counter--;
         
          continue;
        }
        if(key =="alreadyZero")
        {
          counter--;
         
          continue;
        }
        if(key =="amtOfSelectedRecords")
        {
          counter--;
         
          continue;
        }


        
        //if here, is productid and a quantity
        AmountToBuyID = var1 + counter;
        AmountOfCostID = var2 + counter;
        AmountOfQuantityID = var3 + counter;
        BoughtID = var4 + counter;
        oneDivID = var5 + counter;
        ProductIDID = var6 + counter;
      
        var bought = (document.getElementById(BoughtID).value);
        var amtInBuyBox =(document.getElementById(AmountToBuyID).value);
        var quantityInBox = (document.getElementById(AmountOfQuantityID).value);
        var costInBox = (document.getElementById(AmountOfCostID).value); 
        var Product = (document.getElementById(ProductIDID).value); 
       
        var item = amtInBuyBox;
       
        //because amount to buy is nothing than change buying to nothing
        if (item == "")
        { 
          
          item = bought;
        
        }
        //check if is decimal
        if(item % 1 != 0)
        {
          
          return(1);
          
        }

        if(item == 0)
        {

                 
                  hideRow(oneDivID);
                  amtOfHiddenProducts++;
                 
          //continue;
          
        }
        
        else if(item < 0 ) 
        {
          
          var str2 = amtInBuyBox.toString();
         
          flag = "isNegValue";
        }
        else if (isNaN(item ))
        {
          
          var str2 = amtInBuyBox.toString();
         
          flag = "isNegValue";
        }

        
        if (flag == "isNegValue")
        {
          return;
        }

        //quant is amount trying to buy
        string =  string + "id=" + key + "&quant=" + item + "&";
                
    }

    
    
    if (amtOfHiddenProducts == (counter + 1))
    {
      

      window.location.href = "index.html";
      alert("++++++++++am here you see it!");
    
    }
      
    string = string + "userid=" + sessionStorage.getItem("session_userID");

var queryString = string.substring(0, string.length-1);


alert("start zzhere");
              $.ajax({
              url: 'http://localhost:8080/spitBackAmounts',
              type: 'GET',
              dataType: 'json',
              
              
              data:queryString,
              crossDomain: true,
             
              success: function (data1) {

                var flag = "is enough";

                
                if(data1.length == null){

                  for(let key of keys) {
       
                    alert("keys here...");
                    alert(key);
                  if(key =="session_userID")
                  {
                    continue;
                  }
                  else
                  {
                    
                      

                  }
                }

                

                alert("am here you see it!");
                window.location.href = "index.html";
            
                }

                      
                        
                var flag = "enough";
                for (var i = 0; i< data1.length ;i++)
                {

                  
                  
                if(data1[i].IsEnoughQuantity == false)
                {
              
                flag = "not enough";
               
                }

                }

                if (flag == "enough")
                {
                  alert("is enough");
                  //window.location.href = "donePurchase.html";
                }

                alert("done purchase");

              var lengthOfData = data1.length;

              alert(lengthOfData);
              console.log(data1);
              var grandTotal = 0;
              var GrandTotal = BigInt(0);
                for(var i = 0; i<(lengthOfData) ; i++)
                {
                  
                 alert("ahere");
                 alert(i);
                 alert(lengthOfData); 
                 alert(typeof(lengthofData))
                 //GTotalWithTax = 0;
                
                var boughtid = "B" + i; 
                var buyThisManyID = "A" + i;
                var availableID =  "D" + i;
                var costID = "C" + i;
                var totalCostID = "TC" + i;
                var GrandTotalStringID = "GT" + i;
                var oneDivID1 =  "V" + i;
                
                
                /////////

                //buying
                //bought1 = document.getElementById(boughtid).value;
                //bought1 = parseFloat(bought1);
                
                bought1 = 1;
                if(bought1 == 0)// && (amtBuying1 == "" || (isNaN(amtBuying1)) ))
                {
                  //alert("hide2a");
                  
                  hideRow(oneDivID1);
                  amtOfHiddenProducts++;
                  
                }



                /////////
             
                var str1 = false;
                str1 = data1[i].IsEnoughQuantity;

                
                //var num = data1[i].QuantityAvailable;
                //str2 = num.toString();
                
               
                //wasnt enough, so make red
                if (str1 == false)
                {  
                  debugger;

                  document.getElementById(availableID).style.color = 'red';
                  
                  //amount to buy
                  document.getElementById(buyThisManyID).value = 0;
                  //buying
                  document.getElementById(boughtid).value = 0;
                  //total cost for productID
                  document.getElementById(totalCostID).value = "$0.00";
                  alert("here!11");

                }else{
                
                  /*
                  let val1 = document.getElementById(costID).value;
                  alert(val1);

                  val1 = val1.slice(1); //10.00
                  //move decimal two to right
                  val1 = val1 * (10 ** 2);//1000


                  //
                  val1 = parseInt(val1);

                  ////////

                  //get amount to buy : 2
                  var amtBuying = document.getElementById(buyThisManyID).value; 
                  
                  //set bought from amt to buy
                  document.getElementById(boughtid).value = (amtBuying);
                  */

                  ///////

                  alert("start debugging");
                  let n2 = BigInt(0);
                  let n2a = BigInt(0)
                  let n3 = BigInt(0);
                  let n4 = BigInt(0);
                  let n5 = BigInt (0);
                  
                  let n6 = BigInt(0);
                  let n7 = BigInt(0);
                  let n8 = BigInt(0);
                  let n9 = BigInt(0);

                  
                 
                  ////////
                  debugger;

                  let ProductCostString = "";

                  alert("alert big debug!")
                 
                  n2 = document.getElementById(buyThisManyID).value;
                  //n2a = document.getElementById(buyThisManyID).value;
                  let var1 =document.getElementById(totalCostID).value;
                  var1 = var1.substring(1);
                  //var1 = var1.slice(0, -3);
                  n3 = var1;

                  

                  n4 = 50;
                  n5 = 1000;
                  n5a = 1000;
                  n8 = 10000;

                  //
                  let n2b = n2;
                  
                  //total pennies, no taax
                  n2 = n2 * n3;
                  
                  
                  
                  
                  
                  //total with out tax in pennies and multiplied times 1000
                  n5 = n5 * n2;
                  
                  
                  
                  
                  
                  
                  //alert("-2");
                  //alert(n5);  //21000460
                  
                  
                  
                  //tax amount by how many to buy (amount to buy on table)
                  //amount to buy * taxrate * 1000
                  //2 * 50 * 1000 * 
                  //amt to buy * taxrate * 1000 * totalwithout tax in pennies 
                  //n2a = n2b*n4*n5a;//         n2b* n4 * n5a;
                  //alert("-5");
                  //alert(n2a);  //210040600





                  //add pennies and tax and amount
                  //n6 = n5 + n2a;//
                  //alert("-6");
                  //alert(n6);
                  
                  
                  let string1 = (n5).toString();
                  //alert("string1");
                  //alert(string1);//

                  
                  let float1  = parseFloat(string1);
                  //alert("finish");

                  float1 = float1 / 1000.0;
                  //alert("-4");//21000.46
                  //alert(float1);//
                  string1 = ((float1.toFixed(2)).toString());
                 
                  //alert("-1");
                  //alert(string1);//21000.46
                  let string2 = "";
                  





                  
                  alert("partx");
                  alert(string1.length);
                  alert(string1);
                  for(var j = 0; j < string1.length; j++)
                  {
                    if(j == string1.length-3)
                    {
                      continue;
                    }
                    string2 = string2 + string1[j];

                  }







                  
                  
                  alert("apple");
                  
                  //alert("0");
                  //made ready to sum n11grandtotal below allm this
                  alert(string2);

                  n9 = string2;
                  alert(GrandTotal);
                  GrandTotal = GrandTotal + n9;
                  alert(GrandTotal);//02100046


//n6

                  ProductCostString = (n5).toString();
                  //alert("1");
                  alert(ProductCostString);//21000460



                  forCostEachFloat = parseFloat(ProductCostString);

                  forCostEachFloat = forCostEachFloat / 1000.0;
                  //alert("2");
                  alert(forCostEachFloat);//2100046

                  
                  
                  
                  ProductCostString = (forCostEachFloat.toFixed(2)).toString();
                  
                  ProductCostString = "$" + ProductCostString;
                  alert("3");

                  alert(ProductCostString);

                  document.getElementById(totalCostID).value = ProductCostString;



                  
              
                  

                
                
                
                }

                
              }//for
                
                  alert("GrandTotal");
                  alert(GrandTotal);//02100046
                  GrandTotal = GrandTotal / 100;
                  alert(GrandTotal);
                  //mystring = BigInt.toString(grandTotal); 

                  //rounds
                  GrandTotal = GrandTotal.toFixed(2);
                  alert(GrandTotal);
                  stringGrandTotal = "Grand Total:  $" + parseFloat(GrandTotal);
                  alert(stringGrandTotal);
                  document.getElementById(GrandTotalStringID).value = stringGrandTotal;
                

                  
              
                alert("end success function");
            }////sucesss - goto spitback and return values

           
            

          });//ajax

}//function


</script>

</body>
</html>