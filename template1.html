
<!DOCTYPE html>
<html lang="en">

<html>

	<head>

		
		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	  <!DOCTYPE html>
	</head>  

<body>
	<script>
		
	  </script>

	<div>
		
	
           <head>
			<style>
				.test100 {
  				visibility: hidden;
				}

				</style>   
			</head>
			
			{{if(eq .Condition 1)}}

			
			<div id = "{{.Link}}"><b>&nbsp&nbsp&nbsp&nbspThis section is for the keyword : {{.Link}}.</b></div><br>

			{{end}}

			
			<iframe class = "" id="upload_target" name="upload_target"  style="width:0;height:0;border:0px solid #fff;"></iframe> 	

			{{if(eq .CondYellow 1)}}
			<div id = "{{.MainDivID}}" style="background-color:#FFFF00" >
			{{else}}
			<div id = "{{.MainDivID}}">
			{{end}}

			
			<div id  = "" class = "test100_" Value = "" name = "">  
			
			
			
			<div class="row" > 
			<div class="col">
			 <p id = "">product id   : {{.ProductID}} </p> 
			
		

      <form target = "upload_target"  enctype="multipart/form-data" method = "GET" action="/updateForm/?idproducts={{.ProductID}}">
			<h4><center><p id = "">Image</p></center></h4>


			<center><img  height="100" width="100"  src= "/golangproj/uploads/{{.ProductFilename}}" alt="no product image"></center> 

			</div>

			<div class="col">
			<h4><center><p id =""  >Title</p></center></h4>

			<center><p><input id = "{{.TitleID}}" value = "{{.ProductName}}{{.ProductDescription}}" type="text" name="title" placeholder="" readonly></p></center>
			</div>

			<div class="col">

			<h4><center><p id = "">Desc</p></center></h4>

			<center><textarea wrap id = "{{.DescID}}"   value = "{{.ProductDescription}}"  type="text" rows="5" cols="34" readonly></textarea></center>
			</div>

			<div class="col">" 
			<h4><center><p id = "" >Cost</p></center></h4>
			<center><p>	<input id = "{{.CostID}}" value =    "${{.ProductCost}}"     type="" name="title" placeholder="" readonly>		</p></center>
		
			</div>
			</div>
			<div class="row">
			<div class="col">
			
			<h4><center><p id = "" >Quantity</p></center></h4>
			<center><p> <input id = "{{.QuantityID}}" value =  {{.ProductQuantity}}  type="number" name="title" placeholder="" readonly>	</p></center>
			</div>
			
			<div class="col">

			
				
			<h4><center><p id = "" >Keyword 1</p></center></h4>
			<center><p>	<input id = "{{.Key1ID}}" value = "{{.GKeyword1}}" type="text" name="title" placeholder="" readonly>		</p></center>

			</div>

			<div class="col">
			<h4><center><p id = "" >Keyword 2</p></center></h4>
			<center><p>	<input id = "{{.Key2ID}}" value = "{{.GKeyword2}}" type="text" name="title" placeholder="" readonly>		</p></center>

			</div>

			<div class="col">
			<h4><center><p id = "" >Keyword 3</p></center></h4>
			<center><p>	<input id =   "{{.Key3ID}}"  value = "{{.GKeyword3}}" type="text" name="{{.Key3ID}}" placeholder="" readonly> 	</p></center>
			</div>
			</div>
			<div class="row">
			<div class="col">
			
			<h4><center><p id = "" >Amount purchased</p></center></h4>
			<center><p><input id = "{{.AmountPurchasedID}}" value = "{{.AmountPurchased}}" type="text" name="title" placeholder="" readonly ></p></center>

			<h4><center><p id = "" >Amount to purchase</p></center></h4>
			<center><p><input id = "{{.AmountToPurchaseID}}" value = 0 type="number" name="title" placeholder="" ></p></center>
			</div>
		    </div>
			<div class="row">
			<div class="col">
			<center><button onclick="removeRecord('{{.MainDivID}}',  '{{.ProductID}}' )">Remove Record</button></center>
			<center><button onclick="changeFields('{{.MainDivID}}', '{{.ProductQuantity}}', '{{.ProductID}}' , '{{.QuantityID}}', '{{.AmountPurchasedID}}', '{{.AmountToPurchaseID}}' )">submit</button></center>
			</div>
			</div>
			</div>
		    </div>
			</div>
			
			
			<script>
				var firstTime = "yes";
			 var gAccount = [];
			 //var originalQuantity = "{{.ProductQuantity}}";

			function removeRecord(mainDivForRecord, productID)
			{
				alert(productID);

				
				//////
				let keys = Object.keys(sessionStorage);
				
				var string = "";


				var counterOfNewlyAdded = -1;
				//productid
				for(let key of keys) {

					//alert("keys");
					//alert(key);///3

					//amount records
					//counterOfNewlyAdded++;
					//quantity
					//var item = sessionStorage.getItem(key);
					//alert("items");
					//alert(item)

					//if(key == "session_userID")
					//{
					//
					//}
					//remove the key with productid
					if(key == productID.toString())
					{
						alert("removed");
						alert(key);
						alert( productID.toString());
						sessionStorage.removeItem(key);
						//let keys = Object.keys(sessionStorage);
						alert("keys");
						alert(keys);
						//counterOfNewlyAdded--;
						break;
					}
					//makes a second set of same values, with the removed record removed from  second set
					//alert("set");
					//alert(key);
					//sessionStorage.setItem(key, item);

				}//for

				/*
				
				//with additional keys added above
				
				var sessionCounter = -1;

				var thisLoopNum = -1;  
				for(let key of keys) {
					thisLoopNum++;
					
					//remove initial keys that are repeated again from code above, and write the code that was rewritten without the one key that is removed
					//alert("remove----");
					//alert(key);


					//session variable 
					if(key =="session_userID")
					{
						alert("first session variable");
						sessionCounter++;
					}

					alert("sessioncounter");
					alert(key);
					alert(sessionCounter);
					//second
					if(key =="session_userID" && (sessionCounter > 0))
					{
						alert("here+AAAAA");
						//alert(key);
						continue;
					}
					//first sessionstorage:  user
					else if(key =="session_userID" && (sessionCounter == 0))
					{
						alert("remove+BBBBB");
						alert(key);
						sessionStorage.removeItem(key);
					}

					else if (thisLoopNum <= counterOfNewlyAdded)
					{
						alert("removeCCCC");
						alert(counterOfNewlyAdded);
						
						alert(key);
						sessionStorage.removeItem(key);
					}
					

					
					
					

				}//for loop end
				//var queryString = string.substring(0, string.length-1);
				/////
				


				*/


				
				document.getElementById(mainDivForRecord).innerHTML = "";
			
			}//end of function





			//called on 
            var gTotalOfPurchases = 0;
			function changeFields(originalQuantity, productID, quantityID, amountPurchasedID, amountToPurchaseID)
			{
				

				

				//alert(quantityID);

				var amountToBePurchased  = 0;
				var  amountInPurchasedField = 0;
				var amountPurchasedSoFar = 0;
				var value1 = 0;
				var value2 = 0;
				//total of product with server
				amountInPurchasedField = document.getElementById(quantityID).value;
				//already purchased
				amountPurchasedSoFar = document.getElementById(amountPurchasedID).value;
				//alert("in the amount purchased");
				//alert(amountPurchasedSoFar);
				
				//amount held for subtraction when submit button pressed
				amountToBePurchased = document.getElementById(amountToPurchaseID).value;
				//alert(amountToBePurchased);
				
				//alert(amountToBePurchased);
				//document.getElementById(amountPurchasedID).value="";

				
				//if there is enough product go in here - take from quantity amount
				if((parseInt(amountInPurchasedField) >= parseInt(amountToBePurchased))   )//&& parseInt(amountToBePurchased) > 0  )
				{

					
					//
					value1 = document.getElementById(amountToPurchaseID).value; 
					//value2 = amountopurchase + amountpurchaseedsofar
					value2  = parseInt(value1) + parseInt(amountPurchasedSoFar);
					if(value2 < 0)
					{
						document.getElementById(amountToPurchaseID).value = 0;
						return;
					}
					//alert("values");
					//alert(value1);
					//alert(value2);
					//alert(amountPurchasedSoFar)
					
					//puts total in here
					document.getElementById(amountPurchasedID).value = value2 ;
					
					if(value1 > 0){

						//alert("a");
					document.getElementById(quantityID).value = parseInt(amountInPurchasedField) - parseInt(amountToBePurchased) ;
					}else if (value1 == 0)
					{
						//alert("b");
					}

					//negative value for amount to purchase
					//value
					else if ( (parseInt(amountPurchasedSoFar) + parseInt(value1)) > -1){
						//alert("in neg");
						//alert(amountInPurchasedField);
						//alert( amountToBePurchased);
						document.getElementById(quantityID).value = parseInt(amountInPurchasedField) - parseInt(amountToBePurchased) ;
						//
						document.getElementById(amountToPurchaseID).value = 0;
					}


					//alert(amountToBePurchased);
					
					gTotalOfPurchases =  parseInt(gTotalOfPurchases) +  parseInt(amountToBePurchased); 
					
					//alert(amountToBePurchased);
					
					if(gTotalOfPurchases > 0){
                        document.getElementById(amountToPurchaseID).value = 0;
                        //alert("here");
						//alert(amountToBePurchased);
						
						//so far, so good is still in database!
						setData(originalQuantity, productID, amountToBePurchased, 0)
                        return (1);
                    }

					///////////


				

					///////////



				}
				//not enough product
			/*	else if( (parseInt(amountToBePurchased) < 0  ) && ((-1*(parseInt(amountToBePurchased)) + parseInt(amountInPurchasedField ) <= originalQuantity))){

					alert("2");
					//alert(amountToBePurchased);
					//alert(amountInPurchasedField);
					//alert(originalQuantity);
					//alert("a");
					//in field not submitted yet
					value1 = document.getElementById(amountToPurchaseID).value; 
					//total of amount for text box
					value2  = parseInt(amountInPurchasedField) - parseInt(value1);
					//alert(value2);
					//change total in here
					document.getElementById(quantityID).value = value2 ;
					//amount purchaesd  subtracks amounttopurchase 
					document.getElementById(amountPurchasedID).value = parseInt(amountPurchasedSoFar) + parseInt(amountToBePurchased);
					
					//?
					//DONT FORGRT ABOUT SETTING VALUE TO 0, BELOW
					//var amountToRefund = amountToBePurchased;
					//setData(productID, amountToRefund, 1)
				}
				*/
				
				document.getElementById(amountToPurchaseID).value = 0;

								
			}

           var gCounter = -1;

		   //CHANGEFILEDs*******
			//https://stackoverflow.com/questions/17309199/how-to-send-variables-from-one-file-to-another-in-javascript/17309679#17309679
			//https://www.w3docs.com/learn-javascript/localstorage-sessionstorage.html
			
			//called by change fields
			//if negative, the quantitytryingtoset is a possible value
			//reduce bool is 1 for first section, quantity is being reduced 
			function  setData(quantityOfProduct, productID, quantityTryingToSet, reduceBool)
			{
				if(firstTime == "yes")
				{
					//sessionStorage.clear();
					firstTime = "no";
				}
				
				var string = "";
				
				var keyFlag = ""
				var bought, totalquantity = 0;

				//alert("before");





				let keys = Object.keys(sessionStorage);
				//console.log(keys);
				for(let key of keys) {
					//alert("key");
					//alert(key)
					//alert("prodcutid")
					//alert(productID)
				
				//total the quantity and overwrite - is already a record
				if(key == (productID.toString())){
				
					//alert("in this place");
					//alert(productID);
					//alert("setdata");
					keyFlag = "found";
					//sofar
					//alert(sessionStorage.getItem(key));
					
					//bought
					bought = sessionStorage.getItem(key);
					//alert("bought");
					//alert(bought);
					//document.getElementById(amountPurchasedID).value = bought;
					//alert(quantityOfProduct);
					//quantity of records is decreasing
					var totalquantity = 0;
					
					//if (reduceBool)
					//{
					//	//alert("1a");
					//	totalquantity =  parseInt(bought) -  parseInt(quantityTryingToSet);
					//	//alert(quantityOfProduct);
					//}
					//quantity of records is acummulating
					//else 
					{
						//alert("1b");
						//alert(quantityOfProduct);
						//alert(quantityTryingToSet);
						//alert(totalquantity);
						//alert(quantityTryingToSet);
						totalquantity = parseInt(bought) + parseInt(quantityTryingToSet);
						//console.log(document.getElementById(amountPurchasedID).value);
						//document.getElementById(amountPurchasedID).value = 579;//'//totalquantity;
						//alert("quantityOfProduct");
						//alert(quantityOfProduct);
						//alert("quantityTryingToSet");
						//alert(quantityTryingToSet);
						//alert("totalquantity");
						//alert(totalquantity);
						
					}
					
					
					//overwrites
					sessionStorage.removeItem(productID);
					//alert("set");
					//alert(productID);
					//alert(totalquantity);
					sessionStorage.setItem(productID, totalquantity);
					//alert("overwrites")
					break;
				
					}
				}
				//there is no productID record yet, make one here 
				if (keyFlag !=  "found")
				{
					//alert("new item");
					sessionStorage.setItem( parseInt(productID),  parseInt(quantityTryingToSet));
				}
				
                

			}


			</script>

			
			</div>

			</div>
			
			</body>
			</html>
			
			<br><br><br><br><br>

			

            